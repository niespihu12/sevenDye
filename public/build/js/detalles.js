let currentImageIndex=0;const thumbnails=document.querySelectorAll(".thumbnail");function changeMainImage(e){document.querySelectorAll(".thumbnail").forEach((e=>{e.classList.remove("active")})),e.classList.add("active");document.querySelector(".product-image").src=e.getAttribute("data-src"),currentImageIndex=Array.from(thumbnails).indexOf(e)}function navigateImages(e){let t=currentImageIndex+e;t<0&&(t=thumbnails.length-1),t>=thumbnails.length&&(t=0),thumbnails[t].click()}const decrementBtn=document.getElementById("decremento"),incrementBtn=document.getElementById("incremento"),quantityInput=document.getElementById("quantity");decrementBtn.addEventListener("click",(e=>{e.preventDefault();const t=parseInt(quantityInput.value);t>1&&(quantityInput.value=t-1)})),incrementBtn.addEventListener("click",(e=>{e.preventDefault();const t=parseInt(quantityInput.value);t<parseInt(quantityInput.getAttribute("max")||10)&&(quantityInput.value=t+1)}));const sizeInputs=document.querySelectorAll('input[name="size"]');sizeInputs.forEach((e=>{e.addEventListener("change",(function(){const e=this.getAttribute("data-precio");if(e){document.getElementById("precio-producto").innerHTML=`\n                    <?php echo MONEDA ?>${e}\n                    <span class="original-price"><?php echo MONEDA ?>${(1.2*e).toFixed(2)}</span>\n                    <span class="discount-badge">20% OFF</span>\n                `}}))}));const addToCartBtn=document.querySelector(".add-to-cart-btn");addToCartBtn.addEventListener("click",(function(e){e.preventDefault();const t=this.getAttribute("data-id"),n=this.getAttribute("data-token"),a=document.getElementById("quantity").value,i=document.querySelector('input[name="size"]:checked');if(!i)return void alert("Please select a size");const s=i.getAttribute("data-talla-id");this.classList.add("adding"),setTimeout((()=>this.classList.remove("adding")),1e3),fetch("/cart/add",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`id=${encodeURIComponent(t)}&token=${encodeURIComponent(n)}&cantidad=${encodeURIComponent(a)}&talla=${encodeURIComponent(s)}`}).then((e=>e.json())).then((e=>{if(e.ok){const e=document.createElement("div");e.className="success-toast",e.innerHTML='\n                    <i class="fas fa-check-circle"></i>\n                    <span>Product added to cart!</span>\n                ',document.body.appendChild(e),setTimeout((()=>{e.classList.add("show"),setTimeout((()=>{e.classList.remove("show"),setTimeout((()=>e.remove()),300)}),2e3)}),100)}})).catch((e=>console.error("Error:",e)))}));const btnWishlist=document.getElementById("btn-wishlist");function loadReviews(e){const t=document.getElementById("reviews-container");fetch(`/resenas/producto?id=${e}`).then((e=>e.json())).then((e=>{if(e.resultado){if(updateRatingSummary(e.promedio,e.total),t.innerHTML="",0===e.resenas.length)return void(t.innerHTML='\n                <div class="no-reviews">\n                    <p>No reviews yet. Be the first to review this product!</p>\n                </div>\n            ');e.resenas.forEach((e=>{const n=createReviewElement(e);t.appendChild(n)}))}else t.innerHTML='\n            <div class="error-message">\n                <p>Error loading reviews. Please try again later.</p>\n            </div>\n        '})).catch((e=>{console.error("Error:",e),t.innerHTML='\n        <div class="error-message">\n            <p>Error loading reviews. Please try again later.</p>\n        </div>\n    '}))}function createReviewElement(e){const t=new Date(e.creado).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),n=document.createElement("div");return n.className="review-item",n.innerHTML=`\n    <div class="review-header">\n        <div class="reviewer-avatar">\n            <span class="avatar-initial">${e.inicial}</span>\n        </div>\n        <div class="reviewer-info">\n            <div class="reviewer-name">${e.usuario}</div>\n            <div class="review-date">${t}</div>\n        </div>\n    </div>\n    <div class="review-rating">\n        ${generateStarRating(e.calificacion)}\n    </div>\n    <div class="review-content">\n        <p>${e.observaciones}</p>\n    </div>\n`,n}function generateStarRating(e){let t="";for(let n=1;n<=5;n++)t+=n<=e?'<i class="fas fa-star"></i>':n-.5<=e?'<i class="fas fa-star-half-alt"></i>':'<i class="far fa-star"></i>';return t}function updateRatingSummary(e,t){const n=document.getElementById("product-rating-summary");if(n){n.querySelector(".stars").innerHTML=generateStarRating(e);n.querySelector(".review-count").textContent=`(${t} Reviews)`}const a=document.getElementById("overall-rating"),i=document.getElementById("overall-stars"),s=document.getElementById("overall-count");a&&(a.textContent=e.toFixed(1)),i&&(i.innerHTML=generateStarRating(e)),s&&(s.textContent=`Based on ${t} reviews`)}function submitReview(e){e.preventDefault();const t=this.getAttribute("data-producto"),n=document.getElementById("review-content").value,a=document.querySelector('input[name="rating"]:checked').value;n.trim()?(this.disabled=!0,this.innerHTML='<i class="fas fa-spinner fa-spin"></i> Submitting...',fetch("/resenas/guardar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({observaciones:n,calificacion:a,producto_id:t})}).then((e=>e.json())).then((e=>{if(this.disabled=!1,this.innerHTML="Submit Review",e.resultado){const e=document.createElement("div");e.className="success-toast",e.innerHTML='\n            <i class="fas fa-check-circle"></i>\n            <span>Review submitted successfully!</span>\n        ',document.body.appendChild(e),setTimeout((()=>{e.classList.add("show"),setTimeout((()=>{e.classList.remove("show"),setTimeout((()=>e.remove()),300)}),2e3)}),100),document.getElementById("review-content").value="",document.getElementById("star5").checked=!0,loadReviews(t)}else alert(e.mensaje||"Error submitting review.")})).catch((e=>{console.error("Error:",e),this.disabled=!1,this.innerHTML="Submit Review",alert("Error submitting review. Please try again later.")}))):alert("Please write a review before submitting.")}btnWishlist.addEventListener("click",(async function(){const e=this.dataset.producto,t=this.querySelector("i"),n=t.classList.contains("fas");this.classList.add("clicked"),setTimeout((()=>this.classList.remove("clicked")),300);try{let a,i;n?(a="/wishlist/delete",i="POST"):(a="/wishlist/save",i="POST");const s=await fetch(a,{method:i,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({producto:e})}),r=await s.json();if(window.location,r.resultado){n?(t.classList.replace("fas","far"),btnWishlist.classList.remove("active")):(t.classList.replace("far","fas"),btnWishlist.classList.add("active"));const e=document.createElement("div");e.className="wishlist-toast",e.innerHTML=`\n                    <i class="${n?"far fa-heart":"fas fa-heart"}"></i>\n                    <span>${r.mensaje||(n?"Removed from wishlist":"Added to wishlist")}</span>\n                `,document.body.appendChild(e),setTimeout((()=>{e.classList.add("show"),setTimeout((()=>{e.classList.remove("show"),setTimeout((()=>e.remove()),300)}),2e3)}),100)}else"Usuario no autenticado"==r.mensaje?window.location.href="/login":alert(r.mensaje||"An error occurred")}catch(e){console.error("Error:",e)}})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".add-to-cart-btn").getAttribute("data-id");e&&loadReviews(e);const t=document.getElementById("submit-review");t&&t.addEventListener("click",submitReview)})),thumbnails.length>0&&thumbnails[0].classList.add("active");const mainImage=document.querySelector(".product-image"),mainImageContainer=document.querySelector(".main-image-container");mainImageContainer.addEventListener("mousemove",(function(e){const{left:t,top:n,width:a,height:i}=this.getBoundingClientRect(),s=(e.clientX-t)/a,r=(e.clientY-n)/i;mainImage.style.transformOrigin=`${100*s}% ${100*r}%`})),mainImageContainer.addEventListener("mouseenter",(function(){mainImage.style.transform="scale(1.5)"})),mainImageContainer.addEventListener("mouseleave",(function(){mainImage.style.transform="scale(1)"}));