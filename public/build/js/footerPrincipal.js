function updateCartCounter(){fetch("/carrito/count",{method:"GET",headers:{Accept:"application/json"}}).then((e=>e.json())).then((e=>{if(e.count){updateCounter(document.querySelector(".navegacion-secundaria .carrito"),e.count);updateCounter(document.querySelector(".barra-mobile .carrito"),e.count)}})).catch((e=>console.error("Error fetching cart count:",e)))}function updateWishlistCounter(){fetch("/deseos/count",{method:"GET",headers:{Accept:"application/json"}}).then((e=>e.json())).then((e=>{if(e.count){updateCounter(document.querySelector(".navegacion-secundaria .favoritos"),e.count);updateCounter(document.querySelector(".barra-mobile .like"),e.count)}})).catch((e=>console.error("Error fetching wishlist count:",e)))}function updateCounter(e,t){if(!e)return;let n=e.querySelector(".counter-badge");t>0?(n||(n=document.createElement("span"),n.className="counter-badge",e.appendChild(n)),n.textContent=t,n.style.display="flex"):n&&(n.style.display="none")}function toggleWishlist(e){fetch(`/deseos/verificar?producto=${e}`,{method:"GET",headers:{Accept:"application/json"}}).then((e=>e.json())).then((t=>{const n=t.enLista;fetch("/deseos/"+(n?"eliminar":"guardar"),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({producto:e})}).then((e=>e.json())).then((t=>{t.resultado&&(document.dispatchEvent(new CustomEvent("wishlistUpdated")),toggleWishlistButtonState(e,!n),showNotification(t.mensaje))})).catch((e=>console.error("Error toggling wishlist:",e)))})).catch((e=>console.error("Error checking wishlist status:",e)))}function toggleWishlistButtonState(e,t){document.querySelectorAll(`.wishlist-btn[data-id="${e}"]`).forEach((e=>{t?(e.classList.add("active"),e.querySelector("i")&&(e.querySelector("i").classList.remove("bi-heart"),e.querySelector("i").classList.add("bi-heart-fill"))):(e.classList.remove("active"),e.querySelector("i")&&(e.querySelector("i").classList.remove("bi-heart-fill"),e.querySelector("i").classList.add("bi-heart")))}))}function showNotification(e){let t=document.getElementById("notification-container");t||(t=document.createElement("div"),t.id="notification-container",document.body.appendChild(t));const n=document.createElement("div");n.className="notification",n.textContent=e,t.appendChild(n),setTimeout((()=>{n.classList.add("fade-out"),setTimeout((()=>{n.remove()}),500)}),3e3)}function addToCart(e,t=1,n=null){const o=new FormData;o.append("id",e),o.append("cantidad",t);const c=generateToken(e);o.append("token",c),n&&o.append("talla",n),fetch("/carrito/agregar",{method:"POST",body:o}).then((e=>e.json())).then((e=>{e.ok?(document.dispatchEvent(new CustomEvent("cartUpdated")),showNotification("Product added to cart")):showNotification("Error adding product to cart")})).catch((e=>console.error("Error adding to cart:",e)))}function generateToken(e){return"token_"+e}function initializeSearch(e,t){const n=document.getElementById(e),o=document.getElementById(t);n&&o&&(n.addEventListener("input",debounce((function(t){const n=t.target.value.trim();n.length>=2?e.includes("blog")?fetchBlogSearchResults(n,o):fetchProductSearchResults(n,o):(o.innerHTML="",o.classList.remove("show"))}),300)),document.addEventListener("click",(function(e){n.contains(e.target)||o.contains(e.target)||o.classList.remove("show")})),n.addEventListener("focus",(function(){this.value.trim().length>=2&&(e.includes("blog")?fetchBlogSearchResults(this.value.trim(),o):fetchProductSearchResults(this.value.trim(),o))})))}function fetchBlogSearchResults(e,t){t.innerHTML='<div class="loading">Buscando...</div>',t.classList.add("show"),fetch(`/blog/buscar?q=${encodeURIComponent(e)}`).then((e=>e.json())).then((e=>{e.length>0?renderBlogSearchResults(e,t):t.innerHTML='<div class="no-results">No se encontraron artículos</div>'})).catch((e=>{console.error("Error en la búsqueda:",e),t.innerHTML='<div class="error">Error al buscar artículos</div>'}))}function fetchProductSearchResults(e,t){t.innerHTML='<div class="loading">Buscando...</div>',t.classList.add("show"),fetch(`/tienda/buscar?q=${encodeURIComponent(e)}`).then((e=>e.json())).then((e=>{e.length>0?renderProductSearchResults(e,t):t.innerHTML='<div class="no-results">No se encontraron productos</div>'})).catch((e=>{console.error("Error en la búsqueda:",e),t.innerHTML='<div class="error">Error al buscar productos</div>'}))}function renderBlogSearchResults(e,t){t.innerHTML="";const n=document.createDocumentFragment();e.forEach((e=>{const t=document.createElement("a");t.href=`/blog/${e.slug}`,t.className="search-item";const o=e.imagen?`<div class="search-item-image">\n            <img src="/imagenes/${e.imagen}" alt="${e.titulo}">\n        </div>`:"";t.innerHTML=`\n        ${o}\n        <div class="search-item-info">\n            <div class="search-item-title">${e.titulo}</div>\n            <div class="search-item-date">${e.creado}</div>\n        </div>\n    `,n.appendChild(t)})),t.appendChild(n)}function renderProductSearchResults(e,t){t.innerHTML="";const n=document.createDocumentFragment();e.forEach((e=>{const t=document.createElement("a");t.href=`/producto/${e.slug}`,t.className="search-item";const o=e.imagen?`<div class="search-item-image">\n            <img src="/imagenes/${e.imagen}" alt="${e.nombre}">\n        </div>`:"";t.innerHTML=`\n        ${o}\n        <div class="search-item-info">\n            <div class="search-item-name">${e.nombre}</div>\n            <div class="search-item-price">${formatPrice(e.precio)}</div>\n        </div>\n    `,n.appendChild(t)})),t.appendChild(n)}function formatPrice(e){return"$"+parseFloat(e).toFixed(2)}function debounce(e,t){let n;return function(...o){const c=this;clearTimeout(n),n=setTimeout((()=>e.apply(c,o)),t)}}document.addEventListener("DOMContentLoaded",(function(){updateCartCounter(),updateWishlistCounter(),document.addEventListener("click",(function(e){const t=e.target.closest(".wishlist-btn");if(t){const e=t.dataset.id;e&&toggleWishlist(e)}})),document.addEventListener("cartUpdated",(function(){updateCartCounter()})),document.addEventListener("wishlistUpdated",(function(){updateWishlistCounter()})),initializeSearch("blog-search-input","blog-search-results"),initializeSearch("search-input-desktop","search-results-desktop"),initializeSearch("search-input-mobile","search-results-mobile")}));