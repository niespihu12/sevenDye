document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("drop-zone"),t=document.querySelector('#drop-zone input[type="file"]'),n=document.getElementById("previsualizacion-container");function a(e){if(n.innerHTML="",e.length>0){const t=document.createElement("h4");t.className="previsualizacion-titulo",t.textContent=`Imágenes seleccionadas: ${e.length}`,n.appendChild(t);const a=document.createElement("div");a.className="previsualizacion-grid",n.appendChild(a),Array.from(e).forEach(((e,t)=>{if(e.type.startsWith("image/")){const n=new FileReader;n.onload=n=>{const o=document.createElement("div");o.className="previsualizacion-item";const i=document.createElement("img");i.src=n.target.result,i.alt=`Previsualización ${t+1}`;const r=document.createElement("div");r.className="previsualizacion-nombre",r.textContent=e.name.length>20?e.name.substring(0,17)+"...":e.name;const c=document.createElement("div");c.className="previsualizacion-tamano",c.textContent=function(e){if(0===e)return"0 Bytes";const t=1024,n=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+n[a]}(e.size),o.appendChild(i),o.appendChild(r),o.appendChild(c),a.appendChild(o)},n.readAsDataURL(e)}}))}}e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("dragover")})),e.addEventListener("dragleave",(()=>{e.classList.remove("dragover")})),e.addEventListener("drop",(n=>{n.preventDefault(),e.classList.remove("dragover"),n.dataTransfer.files.length&&(t.files=n.dataTransfer.files,a(t.files))})),t.addEventListener("change",(()=>{t.files.length&&a(t.files)}));const o=document.getElementById("categoria"),i=document.getElementById("subcategoria");o&&i&&(o.addEventListener("change",(function(){const e=this.value;i.innerHTML='<option value="">--Seleccione una subcategoría--</option>',""!==e?(i.innerHTML='<option value="">Cargando subcategorías...</option>',fetch(`/products/get-subcategories?categoria_id=${e}`).then((e=>e.json())).then((e=>{if(i.innerHTML="",e.length>0){const t=document.createElement("option");t.value="",t.textContent="--Seleccione una subcategoría--",i.appendChild(t),e.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.nombre,i.appendChild(t)}))}else{const e=document.createElement("option");e.value="",e.textContent="Esta categoría no tiene subcategorías",i.appendChild(e)}})).catch((e=>{console.error("Error al cargar subcategorías:",e),i.innerHTML='<option value="">Error al cargar subcategorías</option>'}))):i.innerHTML='<option value="">--Seleccione primero una categoría--</option>'})),""!==o.value&&o.dispatchEvent(new Event("change")))}));